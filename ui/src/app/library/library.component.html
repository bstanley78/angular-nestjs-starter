<div class="library mt-2 mt-md-4 mt-xl-5">
   <ng-container *ngIf="(allBooks | async).length; else noBooks">
      <form [formGroup]="searchBooksForm">
         <div class="input-group mb-3">
            <input type="text" class="form-control" placeholder="Search..." aria-label="Search..." aria-describedby="button-addon2" formControlName="searchTerm" (keyup)="searchBooks()">
            <button class="btn btn-outline-secondary" type="button" id="button-addon2" (click)="resetTable()">Reset Table</button>
         </div>
      </form>
      <div class="table-responsive">
         <table class="table align-middle table-striped table-hover">
            <caption>Total of <b>{{(allBooks | async)?.length}} books</b> found</caption>
            <thead class="table-dark">
               <tr>
                  <th scope="col">
                     <button class="btn btn-link" (click)="handleSortChange('title')">
                        Title
                        <span *ngIf="sortColumn === 'title' && sortDirection === 1">&#8593;</span>
                        <span *ngIf="sortColumn === 'title' && sortDirection === -1">&#8595;</span>
                     </button>
                  </th>
                  <th scope="col" class="d-none d-md-table-cell">
                     <button class="btn btn-link" (click)="handleSortChange('description')">
                        Description
                        <span *ngIf="sortColumn === 'description' && sortDirection === 1">&#8593;</span>
                        <span *ngIf="sortColumn === 'description' && sortDirection === -1">&#8595;</span>
                     </button>
                  </th>
                  <th scope="col-md-3 col-xl-2" *ngIf="(isLoggedIn | async)">
                     <button class="btn btn-link">
                        Action
                     </button>
                  </th>
               </tr>
            </thead>
            <tbody class="table-group-divider">
               <tr *ngFor="let item of (pagedBooks | async); let i = index">
                  <td>{{item.title}}</td>
                  <td class="d-none d-md-table-cell">{{item.description}}</td>
                  <td *ngIf="(isLoggedIn | async)" class="col-md-3 col-xl-2">
                     <div style="display: flex; align-items: center;" *ngIf="(item?.title || item?.description)">
                        <button class="btn btn-warning" data-bs-toggle="modal" data-bs-target="#bookModal" (click)="handleAction('edit', item)">Edit</button>
                        <div style="margin-left: 10px;"></div>
                        <button class="btn btn-danger" (click)="deleteBook(item)">Delete</button>
                     </div>
                  </td>
               </tr>
            </tbody>
            <nav aria-label="Page navigation">
               <ul class="pagination">
                  <li class="page-item" [class.disabled]="currentPage === 1">
                     <a class="page-link" (click)="goToPage(currentPage - 1)" aria-label="Previous">
                        <span aria-hidden="true">&laquo;</span>
                     </a>
                  </li>
                  <li class="page-item" *ngFor="let page of pages" [class.active]="currentPage === page">
                     <a class="page-link" (click)="goToPage(page)">{{ page }}</a>
                  </li>
                  <li class="page-item" [class.disabled]="currentPage === totalPages">
                     <a class="page-link" (click)="goToPage(currentPage + 1)" aria-label="Next">
                        <span aria-hidden="true">&raquo;</span>
                     </a>
                  </li>
               </ul>
            </nav>
         </table>
      </div>
   </ng-container>
   <ng-template #noBooks>
      <div class="alert alert-warning" role="alert">
         No books available
      </div>
   </ng-template>
   <button *ngIf="(isLoggedIn | async)" class="btn btn-success btn-float position-fixed" data-bs-toggle="modal" data-bs-target="#bookModal" (click)="handleAction('add', null)">Add</button>
</div>

<!-- Modal -->
<div class="modal fade" #bookModal id="bookModal" tabindex="-1" aria-labelledby="bookModalLabel" aria-hidden="true">
   <div class="modal-dialog">
      <div class="modal-content">
         <div class="modal-header">
            <h1 class="modal-title fs-5 text-capitalize" id="bookModalLabel">{{(selectedAction | async)}} Book</h1>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
         </div>
         <div class="modal-body">
            <form [formGroup]="bookForm">
               <div class="mb-3">
                  <label for="title" class="form-label">Title</label>
                  <input type="text" class="form-control" id="title" formControlName="title" name="title">
                  <div *ngIf="bookForm.get('title').hasError('required') && bookForm.get('title').touched" class="text-danger">
                     Title is required.
                  </div>
               </div>
               <div class="mb-3">
                  <label for="description" class="form-label">Description</label>
                  <textarea class="form-control" id="description" formControlName="description" name="description" rows="3"></textarea>
                  <div *ngIf="bookForm.get('description').hasError('required') && bookForm.get('description').touched" class="text-danger">
                     Description is required.
                  </div>
               </div>
            </form>
         </div>
         <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
            <div [ngSwitch]="(selectedAction | async)">
               <ng-container *ngSwitchCase="'add'">
                  <!-- Add Book -->
                  <button type="button" class="btn btn-success" (click)="addBook()">Add</button>
               </ng-container>
            
               <ng-container *ngSwitchCase="'edit'">
                  <!-- Edit Book -->
                  <button type="button" class="btn btn-warning" (click)="editBook()">Edit</button>
               </ng-container>
            
               <ng-container *ngSwitchCase="'delete'">
                  <!-- Delete Book -->
                  <button type="button" class="btn btn-danger" (click)="deleteBook()">Delete</button>
               </ng-container>
            
               <ng-container *ngSwitchDefault>
                  <!-- Default case (unknown action) -->
                  <button type="button" class="btn btn-primary" disabled>Save changes</button>
               </ng-container>
            </div>
         </div>
      </div>
   </div>
</div>
